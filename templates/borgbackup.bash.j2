#!/bin/bash
set -e
{% for repo in repos %}

{% if repo.encryption_passphrase is defined and repo.encryption_passphrase | length > 0 %}
export BORG_PASSPHRASE=$(cat "{{private_working_directory}}/{{repo.archive}}.txt")
{% endif %}
{{borg_executible}} create \
            --stats \
            --compression {{repo.compression_mode}} \
            {{repo.repo_path}}::{{repo.archive}}-`date +%s` \
            {% for path in repo.paths %}"{{path}}" {% endfor %}


{% endfor %}
