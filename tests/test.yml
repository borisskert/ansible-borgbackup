---
- hosts: test_machine
  become: yes

  roles:
    - role: setup-borgbackup
      version: 1.1.11
      private_working_directory: /srv/borgbackup
      ignore_failing_repos: yes
      no_strict_host_key_checking: yes
      repos:
        - repo_path: /mnt/borgbackups/etc-backups
          encryption_mode: repokey
          encryption_passphrase: "thi5 is-mY_p@5sphr4s3 for /etc"
          passphrase_filename: etc_passphrase.txt
          prune:
            keep_within: 1d
            keep_daily: 7
            keep_weekly: 4
            keep_monthly: 12
          archives:
            - name: etc-archive
              compression_mode: lzma,4
              paths:
                - /etc
        - repo_path: /mnt/borgbackups/home-and-root-backups
          encryption_mode: repokey-blake2
          encryption_passphrase: "thi5 is-mY_p@5sphr4s3 for /home and /root"
          passphrase_filename: home_root_passphrase.txt
          prune:
            keep_daily: 7
          archives:
            - name: home-archive
              compression_mode: none
              paths:
                - /home
            - name: root-archive
              compression_mode: none
              paths:
                - /root
        - repo_path: /mnt/borgbackups/opt-backups
          prune:
            keep_weekly: 4
            keep_monthly: 12
          archives:
            - name: opt-archive
              compression_mode: none
              paths:
                - /opt
        - repo_path: ssh://my_ssh_user@remote_server.org//home/my_remote_path
          encryption_mode: repokey
          encryption_passphrase: "thi5 is-mY_p@5sphr4s3"
          passphrase_filename: remote_backup_passphrase.txt
          archives:
            - name: my-remote-archive
              compression_mode: lzma,9
              paths:
                - /etc
                - /home
                - /srv
                - /root
        - repo_path: ssh://my_other_ssh_user@other_remote_server.org//home/my_other_remote_path
          archives:
            - name: my-other-remote-archive
              compression_mode: lzma,2
              paths:
                - /etc
                - /home
                - /srv
                - /root
